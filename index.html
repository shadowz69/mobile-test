<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>message</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        height: 100vh;
        overflow: hidden;
        justify-content: center;
        background: #000;
      }
      #container {
        position: relative;
        width: 360px;
        height: 620px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
        border-radius: 12px;
        overflow: hidden;
        margin-top: 10px;
      }

      @media (max-width: 480px) {
        #container {
          width: 100vw;
          height: 100vh;
          margin-top: 0;
          border-radius: 0;
        }
      }

      canvas {
        display: block;
        width: 100%;
        height: 100%;
      }

      #showButton {
        position: absolute;
        top: 20px;
        z-index: 100;
        padding: 14px 30px;
        font-size: 18px;
        border: none;
        border-radius: 8px;
        background: linear-gradient(90deg, rgb(83, 228, 192), #08f437);
        color: white;
        cursor: pointer;
      }

      #overlay {
        position: absolute;
        top: 20px;
        left: 20px;
        right: 20px;
        bottom: 20px;
        background-color: rgba(0, 0, 0, 0.85);
        border-radius: 10px;
        z-index: 10;
        display: none;
        user-select: none;
        padding: 20px;
        color: #eee;
        font-size: 18px;
        line-height: 1.5;
        overflow-y: auto;
      }

      #closeOverlay {
        position: absolute;
        top: 8px;
        right: 12px;
        font-weight: bold;
        font-size: 24px;
        color: white;
        background-color: rgba(0, 0, 0, 0.5);
        border-radius: 50%;
        width: 32px;
        height: 32px;
        line-height: 32px;
        text-align: center;
        cursor: pointer;
        z-index: 20;
      }

      #pixelSizeControl {
        position: absolute;
        top: 8px;
        right: 8px;
        display: none;
        flex-direction: column;
        align-items: center;
        z-index: 30;
      }

      #fontSizeSlider {
        width: 80px;
        margin: 4px 0;
      }

      #pixelSizeValueDisplay {
        width: 40px;
        height: 28px;
        background: #333;
        color: #0f0;
        font-weight: bold;
        font-size: 16px;
        border-radius: 6px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: "Courier New", monospace;
      }

      #pixelSizeLabel {
        background: #08f437;
        color: black;
        padding: 6px 12px;
        border-radius: 16px;
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 6px;
        text-align: center;
        max-width: 110px;
      }

      audio {
        display: none;
      }
    </style>
  </head>
  <body>
    <button id="showButton">Show Message</button>
    <div id="container" style="display: none">
      <canvas id="textPortrait"></canvas>
      <div id="overlay">
        <div id="closeOverlay" title="Close Overlay">&#10005;</div>
        <div id="overlayText">
          <h2>HAPPY BIRTHDAY KIM ðŸŽ‚ðŸ¥³</h2>
          <p>
            Another year older, but still slayin' You're such a good friend and
            it is very fun when I'm with you, I kinda lowkey missing the moments
            when we are stressing out to the coding project that our professors
            gave us even though our outputs are AI generated. I just want to tell
            you that no matter how hard life is just keep on fighting and don't
            hesitate to ask me for help when you need it. Once again Happy
            birthday and enjoy your day.
          </p>
          <p>Lots of love, Raymund</p>
        </div>
      </div>
    </div>
    <div id="pixelSizeControl">
      <div id="pixelSizeLabel">Font Size</div>
      <input type="range" id="fontSizeSlider" min="1" max="30" value="10" />
      <div id="pixelSizeValueDisplay">10</div>
    </div>
    <audio id="backgroundAudio" loop>
      <source src="sound.mp3" type="audio/mpeg" />
    </audio>

    <script>
      const message = `HappyBirthday`;
      const imageURL = "kim.png";

      const canvas = document.getElementById("textPortrait");
      const ctx = canvas.getContext("2d");
      const container = document.getElementById("container");
      const showButton = document.getElementById("showButton");
      const overlay = document.getElementById("overlay");
      const closeOverlay = document.getElementById("closeOverlay");
      const pixelSizeControl = document.getElementById("pixelSizeControl");
      const pixelSizeValueDisplay = document.getElementById("pixelSizeValueDisplay");
      const fontSizeSlider = document.getElementById("fontSizeSlider");
      const audio = document.getElementById("backgroundAudio");

      let fontSize = parseInt(fontSizeSlider.value);
      let loadedImageData = null;
      const dpr = window.devicePixelRatio || 1;
      const vw = window.innerWidth;
      const vh = window.innerHeight;

      canvas.width = vw * dpr;
      canvas.height = vh * dpr;
      canvas.style.width = vw + "px";
      canvas.style.height = vh + "px";
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

      const img = new Image();
      img.crossOrigin = "anonymous";
      img.src = imageURL;

      img.onload = () => {
        const offCanvas = document.createElement("canvas");
        offCanvas.width = canvas.width;
        offCanvas.height = canvas.height;
        const offCtx = offCanvas.getContext("2d");
        offCtx.drawImage(img, 0, 0, offCanvas.width, offCanvas.height);
        loadedImageData = offCtx.getImageData(0, 0, offCanvas.width, offCanvas.height);
      };

      function drawTextPortrait(fontSizeLocal, textToDraw) {
        if (!loadedImageData) return;
        const width = canvas.width / dpr;
        const height = canvas.height / dpr;
        const data = loadedImageData.data;

        ctx.clearRect(0, 0, width, height);
        ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, width, height);

        const lineHeight = fontSizeLocal * 1.2;
        const charWidth = fontSizeLocal * 0.6;
        const cols = Math.floor(width / charWidth);
        const rows = Math.floor(height / lineHeight);

        let cleanMsg = textToDraw.trim().replace(/\s+/g, " ");
        while (cleanMsg.length < cols * rows) cleanMsg += " " + message;
        cleanMsg = cleanMsg.slice(0, cols * rows);

        ctx.font = `${fontSizeLocal}px Courier New, monospace`;
        ctx.textBaseline = "top";

        let i = 0;
        for (let y = 0; y < rows; y++) {
          for (let x = 0; x < cols; x++) {
            const letter = cleanMsg[i++];
            const px = Math.floor(x * charWidth * dpr);
            const py = Math.floor(y * lineHeight * dpr);
            const index = (py * canvas.width + px) * 4;
            const [r, g, b, a] = [data[index], data[index + 1], data[index + 2], data[index + 3]];
            if (a === 0) continue;
            ctx.fillStyle = `rgba(${r},${g},${b},${a / 255})`;
            ctx.fillText(letter, x * charWidth, y * lineHeight);
          }
        }
      }

      function drawTextPortraitWithTyping(fontSizeLocal, fullText) {
        let currentIndex = 0;
        let displayedText = "";
        function type() {
          if (currentIndex <= fullText.length) {
            displayedText = fullText.slice(0, currentIndex);
            drawTextPortrait(fontSizeLocal, displayedText);
            currentIndex++;
            setTimeout(type, 2);
          }
        }
        type();
      }

      showButton.addEventListener("click", () => {
        showButton.style.display = "none";
        container.style.display = "block";
        overlay.style.display = "block";
        audio.play().catch((e) => console.warn("Audio play blocked", e));
      });

      closeOverlay.addEventListener("click", () => {
        overlay.style.display = "none";
        pixelSizeControl.style.display = "flex";
        drawTextPortraitWithTyping(fontSize, message);
      });

      fontSizeSlider.addEventListener("input", () => {
        fontSize = parseInt(fontSizeSlider.value);
        pixelSizeValueDisplay.textContent = fontSize;
        drawTextPortrait(fontSize, message);
      });
    </script>
  </body>
</html>
